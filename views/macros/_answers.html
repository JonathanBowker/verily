{% macro answers_embeded(answers, crisis_id) %}
    <script type="text/javascript">
        $(function(){
            {% if user %}
                $(".btn_downvote").click(function(){
                    var button = $(this);
                    $.post('/crisis/'+button.attr('data-crisis-id')+'/question/'+button.attr('data-question-id') +'/answer/'+button.attr('data-answer-id')+'/downvote',
                            function(data){
                                var answer = data;
                                update_votes(answer, button);
                            }).fail(function(){
                                show_alert_message('danger', 5000, "Error", "There was an unknown error, please try again later. ");
                            });
                });
                $(".btn_upvote").click(function(){
                    var button = $(this);
                    $.post('/crisis/'+button.attr('data-crisis-id')+'/question/'+button.attr('data-question-id') +'/answer/'+button.attr('data-answer-id')+'/upvote',
                            function(data){
                                var answer = data;
                                update_votes(answer, button);
                            }).fail(function(){
                                show_alert_message('danger', 5000, "Error", "There was an unknown error, please try again later. ");
                            });
                });
            
            {% endif %}
        });
        var update_votes = function(answer, element){
            element.parents('.answer-buttons').find('.upvote_count').html(answer.post.upvoteCount);
            element.parents('.answer-buttons').find('.downvote_count').html(answer.post.downvoteCount);
            element.parents('.answer-buttons').find('.btn_downvote').removeClass('active').removeClass('disabled');
            element.parents('.answer-buttons').find('.btn_upvote').removeClass('active').removeClass('disabled');
            element.addClass('active').addClass('disabled');
        }
    </script>
    {% for answer in answers %}
        <div class="col-sm-4">
            <div class="panel panel-default question-answer">
                <div class="question-answer-bar {% if answer.type === 'support' %}label-success{% else %}label-danger{% endif %}">
                    {% if answer.type === 'support' %}
                        <span class="text-success metric true">
                            <i class="fa fa-check"></i>
                        </span>
                    {% else %}
                        <span class="text-danger metric false">
                            <i class="fa fa-times"></i>
                        </span>

                    {% endif %}
                </div>
                <div class="panel-heading">
                        {% if answer.post.targetLocality %}
                            <div class="">
                               <i class="fa fa-map-marker"></i>
                               <span class="sr-only">Locality:</span>
                               <span id="answer-locality">{{ answer.post.targetLocality }}</span>
                            </div>
                        {% endif %}

                    <h3 class="panel-title">
                        {{ answer.post.title }}
                    </h3>


                </div>
                <div class="panel-body">


                    {{ answer.post.text }}
                    
                    {% if answer.post.targetImage %}
                        <div class="row">
                            <img src="{{ answer.post.targetImage }}" class="img-responsive center-block answer-image">
                        </div>
                    {% endif %}
                    
                        <div class="">
                            <i class="fa fa-bullhorn"></i>
                            <span class=""><abbr title="{{ question.date.toUTCString() }}">{{ question.relativeCreatedDate }}</abbr></span>
                            by {{ question.author }}
                        </div>

                    <!-- vote row -->
                    <div class="row answer-buttons">

                        <!-- button-vote-up -->
                        {% set answer_upvoted = answer | isUpvotedBy(user) %}
                        <div class="mini action-button-ctr btn-group">
                            <button data-crisis-id="{{ crisis_id }}" data-question-id="{{ answer.question_id }}" data-answer-id="{{ answer.id }}" class="btn btn-default btn-large mini-action-button btn_upvote {% if !user %} user-required-action{% endif %} {% if answer_upvoted %}disabled{% endif %}"  title="Upvote"><i class="fa fa-arrow-up"></i></button>
                            <a href="#" class="btn btn-default action-button-count upvote_count">{{ answer.post.upvoteCount }}</a>
                        </div>
                        <!-- / button-vote-up -->

                        <!-- button-vote-down -->
                        <div class="mini action-button-ctr btn-group">
                            {% set answer_downvoted = answer | isDownvotedBy(user) %}
                            <button data-crisis-id="{{ crisis_id }}" data-question-id="{{ answer.question_id }}" data-answer-id="{{ answer.id }}" class="btn btn-default btn-large mini-action-button btn_downvote {% if !user %} user-required-action{% endif %} {% if answer_downvoted %}disabled{% endif %}" title="Downvote"><i class="fa fa-arrow-down"></i></button>
                            <a href="#" class="btn btn-default action-button-count downvote_count answer_number_{{ answer.id }}">{{ answer.post.downvoteCount }}</a>
                        </div>
                        <!-- / button-vote-down -->

                        <!-- button-comment -->
                        <div class="mini action-button-ctr btn-group">
                            <button class="btn btn-default btn-large mini-action-button" title="Comment"><i class="fa fa-comment"></i></button>
                            <a href="#" class="btn btn-default action-button-count">9999</a>
                        </div>
                        <!-- / button-comment -->
                    </div>
                    <!-- / vote row -->

                </div>
            </div>
        </div>
    {% endfor %}
{% endmacro %}