{% extends '../layout.html' %}

{% block breadcrumb %}
<li>
    <a href="/crisis/example" title="Crisis">Example Crisis</a>
</li>
<li>
    <a href="/question/{{ question.id }}" title="Question">{{ question.title }}</a>
</li>
{% endblock %}

{% block content %}
<!-- question -->
<div class="page-header question border-true">
    <div class="row">
        <div class="col-sm-9">
        <h2>{{ question.title }}</h2>

                <p class="lead">
                    {{ question.text }}
                </p>
                
                {% if question.targetDateTimeOccurred %}
                <p class="metadata">
                    <i class="fa fa-clock-o fa-lg fa-fw"></i>
                    <span class="sr-only">Occurred:</span>
                    <span class="">{{ question.relativeTargetDateTimeOccurred }}</span>
                    <span class="text-muted">
                        &middot;
                    {{ question.targetDateTimeOccurred|date('D, d M Y H:i:s') }}
                     <abbr title="Coordinated Universal Time" class="initialism">
                         <a href="http://en.wikipedia.org/wiki/Coordinated_Universal_Time">UTC</a>
                     </abbr>
                     </span>
                </p>
                {% endif %}


                {% if question.targetLocality or question.targetLat %}
                <p class="metadata">
                    {% if question.targetLocality %}
                    <i class="fa fa-map-marker fa-lg fa-fw"></i><span class="sr-only">Locality:</span>&nbsp;<span id="question-locality">{{ question.targetLocality }}</span>
                    {% endif %}
                    
                    {% if question.targetLat and question.targetLong %}
                    <i class="fa fa-crosshairs fa-lg fa-fw"></i> <span class="sr-only">Lat Long:</span> <a href="geo:{{ question.targetLat }},{{ question.targetLong }}"><span id="question-target-lat">{{ question.targetLat }}</span>, <span id="question-target-long">{{ question.targetLong}}</span></a>
                    {% endif %}
                </p>
                {% endif %}

                <p class="metadata">
                    <i class="fa fa-bullhorn fa-lg fa-fw"></i>
                    <span class=""><abbr title="{{ question.date.toUTCString() }}">{{ question.relativeCreatedDate }}</abbr></span>
                    by {{ question.author }}
                </p>

                {% if question.tags and question.tags.length !== 0 %}
                <p class="metadata">
                    <i class="fa fa-tag fa-lg fa-fw"></i>
                        {% for tag in question.tags %}
                            <a href="/tag/{{ tag }}"><span class="label label-primary tag">{{ tag }}</span></a>
                        {% endfor %}
                </p>
                {% endif %}
                
            </div>
            <div class="col-xs-12 col-sm-3 action-buttons">
                <div class="row">
                    
                    <!-- button-mark-true -->
                    <div class="action-button-ctr btn-group">
                        <button class="btn btn-success btn-large text-action-button" id="question-support" title="Support"><i class="fa fa-check" id="icon-support"></i> <span class="sr-only">Support</span><strong class="hidden-xs">Support</strong></button>
                        <a href="#" class="btn btn-default action-button-count back-coloured">{{ question.supportedAnswerCount }}</a>
                    </div>
                    <!-- / button-mark-true -->
                    
                    <!-- button-mark-false -->
                    <div class="action-button-ctr btn-group">
                        <button class="btn btn-danger btn-large text-action-button" id="question-reject" title="Reject"><i class="fa fa-times" id="icon-reject"></i> <span class="sr-only">Reject</span><strong class="hidden-xs">Reject</strong></button>
                        <a href="#" class="btn btn-default action-button-count back-coloured">{{ question.rejectedAnswerCount }}</a>
                    </div>
                    <!-- / button-mark-false -->
                    
                    <!-- button-mark-important -->
                    <div class="action-button-ctr btn-group">
                        <button class="btn btn-default btn-large text-action-button" title="Mark as important"><i class="fa fa-exclamation"></i> <span class="sr-only">Important</span><strong class="hidden-xs">Important</strong></button>
                        <a href="#" class="btn btn-default action-button-count">99</a>
                    </div>
                    <!-- / button-mark-important -->
                            
                </div>
                
                <!-- / action buttons row -->
                                                    
            </div>
            <!-- / action-buttons -->
            
            
            
        </div>
        <!-- / question header row -->
        
        <!-- small buttons -->
        <div class="btn-group">
            <div class="additional-button-ctr">
                <a href="/question/{{ question.id }}/edit" class="btn btn-default btn-sm"><i class="fa fa-edit"></i> <strong>Edit</strong></a>
            </div>
        </div>
        
        <div class="btn-group">
            <div class="additional-button-ctr">
                <button class="btn btn-default btn-sm"><i class="fa fa-flag"></i> <strong>Flag</strong></button>
            </div>
        </div>
        <!-- / small buttons -->
        
        
    </div>
<!-- / question -->

<!-- create evidence -->
{% include '../evidence/create.html' %}
<!-- / create evidence -->



<div class="row question-image-and-map">
    {% if question.targetImage %}
    <div class="col-sm-6">
        <img src="http://www.southampton.ac.uk/images/inline/choose_southampton.jpg" class="img-responsive">
    </div>
    <div class="col-sm-6">
    {% else %}
    <div class="col-sm-12">
    {% endif %}
        <div id="map" class="smallmap" style="height: 300px;"></div>
        <!-- <img src="http://maps.googleapis.com/maps/api/staticmap?center=-15.800513,-47.91378&zoom=11&size=700x400&sensor=false" alt="map" class="img-responsive"> -->
    </div>    
</div>



<div class="row">
    <!-- <button class="btn btn-primary btn-large"><i class="fa fa-reply"></i> <strong>Verify</strong></button> -->
    
    
</div>

<div class="row question-answers">
    {% for answer in question.answers %}
        <div class="col-sm-4">
            {% include '../evidence/one-embed.html' with answer %}
        </div>   
    {% endfor %}
</div>




<script type="text/javascript">
// Support/Reject handle

// Hidden field of question type.
var questionType = document.getElementById('form-question-type');

// Display of question type
var labelQuestionType = document.getElementById('form-label-question-type');
var questionTypeClassName = labelQuestionType.className;

// Remove all children from an element
function resetElement(target) {
    while (target.firstChild) {
        labelQuestionType.removeChild(target.firstChild);
    }
}

document.getElementById('question-support').addEventListener('click', function(e) {
    questionType.value = 'support';
    
    var supportIcon = document.createElement('i');
    supportIcon.className = 'fa fa-check';
    var content = document.createTextNode(' Support');
    
    resetElement(labelQuestionType);
    labelQuestionType.insertBefore(content, labelQuestionType.nextSibling);
    labelQuestionType.insertBefore(supportIcon, content);    
    labelQuestionType.className = questionTypeClassName + ' label-success';
    displayForm();
});

document.getElementById('question-reject').addEventListener('click', function(e) {
    questionType.value = 'reject';
    
    var rejectIcon = document.createElement('i');
    rejectIcon.className = 'fa fa-times';
    var content = document.createTextNode(' Reject');

    resetElement(labelQuestionType);
    labelQuestionType.insertBefore(content, labelQuestionType.nextSibling);
    labelQuestionType.insertBefore(rejectIcon, content);
       
    labelQuestionType.className = questionTypeClassName + ' label-danger';
    displayForm();
});

function displayForm() {
    // Display the form.
    var formCtr = document.getElementById('form-ctr')
    formCtr.style.display = 'block';
    var formTitle = document.getElementById('form-title');
    formTitle.focus();
    
    // Update chars left
    displayCharsLeft();
    
    // Scroll the top of the form into view.
    //formCtr.scrollIntoView();
    
}



</script>
<script src="http://openlayers.org/api/OpenLayers.js"></script>
<script type="text/javascript">
var map, layer;
function init(){
    map = new OpenLayers.Map( 'map');
    layer = new OpenLayers.Layer.OSM( "Simple OSM Map");
    map.addLayer(layer);
    map.setCenter(
        new OpenLayers.LonLat(-1.422, 50.930).transform(
            new OpenLayers.Projection("EPSG:4326"),
            map.getProjectionObject()
        ), 12
    ); 
    
    // Add Vector marker
    var vectorLayer = new OpenLayers.Layer.Vector("Overlay");
    var feature = new OpenLayers.Feature.Vector(
     new OpenLayers.Geometry.Point(-71.147, 42.472),
     {some:'data'},
     {externalGraphic: 'img/marker.png', graphicHeight: 21, graphicWidth: 16});
    vectorLayer.addFeatures(feature);
    map.addLayer(vectorLayer);
};
init();
</script>

{% endblock %}
